# 应用层

## 2.1应用协议原理

研发网络应用程序的核心是写出能运行在不同端系统和通过网络彼此通信的程序

网络核心的基本设计将应用软件限制在端系统，促进了大量的网络应用程序的研发和部署

### 2.1.1网络应用程序体系结构

应用程序体系结构规定了如何在各种端系统上组织该应用程序，很可能使用P2P体系结构

客户—服务器体系结构：

- 1.通过服务器服务于来在用户主机的请求
- 2.具有固定的地址（IP地址）

为应对巨量的用户请求，数据中心常被用于创建强大的虚拟服务器

P2P体系结构：

- 1.对专用服务器依赖性很小
- 应用程序在间断连接的主机对之间使用直接通信 例：文件共享 视频会议
- 具有自扩展性 优势：不需要庞大的服务器基础设施和服务器带宽 劣势：由于其高度非集中式结构，面临安全性、性能和可靠性等挑战

二者在特定情况下会结合使用

### 2.1.2进程通信

进程可以被认为是运行在端系统中的一个程序 多个进程可以在端系统间相互通信。在不同端系统上的进程，通过跨越计算机网络交换报文相互通信

#### 1.客户和服务器进程

网络应用程序由成对的进程组成，进程通过网络相互发送报文。通常将两进程之一标识为客户，另一方为服务器

#### 2.进程与计算机网络之间的接口

进程通过套接字的软件接口向网络发送报文和接收报文

套接字也称为应用程序和网络之间的应用程序接口（API）应用程序开发者只能控制其在应用层端的一切，但是几乎没有在运输层端的控制权 如选择运输层协议，也许能设定几个运输层参数

#### 3.进程寻址

只有知道目标主机IP地址，以及接受相应的套接字，才能够完成进程的发送和接收。目的地端口号用于此目的。如Web服务器端口号为80，邮件服务器端口号用25来标识

### 2.1.3可供应用程序使用的运输服务

运输层协议可以为应用程序提供的服务：

- 1.可靠数据传输 ：保证数据传输不会丢失
- 2.吞吐量：运输层协议能保证以某种特定的速率提供确保的可用吞吐量  具有此特性的应用程序被称为带宽敏感的应用，与之相对的则称为弹性应用
- 3.定时保证
- 4.安全性：对数据进行加密

### 2.1.4因特网提供的运输服务

因特网为应用程序提供两个运输层协议，即UDP和TCP

- 1.TCP服务：包括面向连接服务和可靠数据传输服务
  - 面向连接的服务：在连接之前进行“握手”过程，此阶段结束后建立一个TCP连接，连接双方同时发送报文，结束报文发送后拆除此连接。
  - 可靠的数据传送服务：通信进程能够依靠TCP无差错且按适当顺序交付所有发送的数据。

​        TCP协议还具有拥塞控制机制，在出现网络拥塞时可以抑制客户或者服务器的发送进程。同时此机制也试图                       控制每个TCP连接，使它们达到公平共享网络带宽的目的

​        针对TCP无加密机制所带来的安全性问题，因特网界研制了加强版本，即安全套接字层（SSL）其安全性服务包括加密、数据完整性和端点鉴别。如需在应用程序使用此服务，则需要在该应用程序的客户端和服务器端包括SSL代码。SSL有它自己类似于传统TCP的API

- 2.UDP服务：此服务是一种轻量级运输协议。在两个进程通信前没有握手过程。其提供的也是一种不可靠的数据传送服务，且不具有拥塞控制进程
- 3.因特网传输协议不提供的服务：今天的因特网通常能够为时间敏感应用提供满意的服务，但并不能提供任何定时或带宽保证。

### 2.1.5应用层协议

此协议定义了运行在不同端系统上的应用程序进程如何相互传递报文。包括1.交换的报文类型，例如请求报文和相应报文。2.各种报文类型的语法，如报文中的各个字段及这些字段时如何描述的。3.字段的语义，即这些字段中信息的含义。4.确定一个进程何时以及如何发送报文，对报文进行响应的规则。

需要区分网络应用和应用层协议，应用层协议只是网络应用重要的一部分。

## 2.2 Web 和 HTTP

> 按需操作的Web

### 2.2.1 HTTP 概况

Web的应用层协议是超文本传输协议（HTTP），也是Web的核心。

Web页面是由对象组成的。多数Web页面含有一个HTML基本文件以及几个引用对象（通过URL）。每个URL地址由两部分组成：存放对象的服务器主机名和对象的路径名。

HTTP是一个无状态协议，不保存用户的任何信息。Web

使用了客户-服务器的应用程序体系结构，即其服务器总保持开启状态，具有固定IP地址

### 2.2.2 非持续连接和持续连接

> HTTP默认方式下使用持续链接

- 1.采用非持续连接：

  每个TCP连接在服务器发送一个对象后关闭，即该连接并不为了其他的对象而持续下来。在此过程中用户可能选择使用并行，这样会缩短响应时间。

  往返时间（RTT）的定义：指一个短分组从客户到服务器然后再返回客户所花费的时间。

  用户点击一个超链接，总响应时间是两个RTT加上服务器传输HTML文件的时间

  非持续连接的缺点：第一，必须为每一个请求对象建立和维护一个全新的连接，给Web服务器造成巨大负担。第二，经受两倍RTT交付时延。

- 2.采用持续连接的HTTP

  TCP连接打开后，再相同客户与服务器之间，后续请求和响应报文能通过相同连接传送。

- 3.HTTP报文格式

  包括两种：请求报文和响应报文。

  - 请求报文：

    第一行为请求行 其后继行叫做首部行。请求行包括三个字段：方法字段、URL字段和HTTP版本字段。

